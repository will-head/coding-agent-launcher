# Interactive Workflow (10-Step)

> Default workflow for direct code changes with user approvals at each step

**Use When:** Making code changes directly to the main branch with interactive approvals

**Key Principles:**
- **User approval required** - ask permission before ALL commands
- **Blocking checkpoints** - each step must complete before proceeding
- **Code review mandatory** - all code/script changes reviewed before commit
- **Documentation-only exception** - skip tests/build/review for `.md` files only

---

## Overview

The Interactive workflow is the default workflow for making code changes directly to the main branch. It requires explicit user approval before running any commands (git, build, tests, installs), ensuring the user maintains full control over all operations.

**Target:** main branch (direct commits)
**Approvals:** Required for all commands
**Steps:** 10 (full workflow) or simplified for docs-only

---

## Session Start Procedure

Follow [Session Start Procedure](WORKFLOWS.md#session-start-procedure) from Shared Conventions, highlighting:
- This is the Interactive workflow (10-step with approvals)
- Key principles: user approval required, blocking checkpoints, code review mandatory
- 10 steps for code or simplified 3-step for docs-only
- Present available TODOs using [Numbered Choice Presentation](WORKFLOWS.md#numbered-choice-presentation)

---

## Documentation-Only Changes

For changes **only** to `.md` files or code comments:

1. Make changes
2. Ask user approval to commit
3. Commit and push

**Skip:** tests, build, and code review for docs-only changes.

---

## Code/Script Changes (Full 10-Step Workflow)

**Each step is a blocking checkpoint.**

### Step 1: Implement

- Use TDD: write failing test first, implement code, verify test passes
- Follow Go conventions and shell script best practices
- Make minimum changes needed to accomplish the goal
- Avoid over-engineering or adding unnecessary features

**Exception:** Read/Grep/Glob tools for searching code do not require approval.

### Step 2: Test

- **Ask user approval** before running
- Execute: `go test ./...`
- **Stop if tests fail** - fix issues before proceeding

All tests must pass to continue.

### Step 3: Build

- **Ask user approval** before running
- Execute: `go build -o cal ./cmd/cal`
- **Stop if build fails** - fix issues before proceeding

Build must succeed to continue.

### Step 4: Code Review

Review code changes for:
- **Code quality** - Readability, maintainability, modularity
- **Test coverage** - All scenarios tested (valid inputs, invalid inputs, errors, edge cases)
- **Security** - Input validation, no injection risks, proper error handling
- **Performance** - Efficient algorithms, no unnecessary operations
- **Go conventions** - Idiomatic Go code
- **Shell script best practices** - Proper quoting, error handling
- **New TODOs** - Must add to PLAN.md

Document findings with:
- File and line references
- Severity ratings (critical, moderate, minor)
- Specific recommendations

### Step 5: Present Review

- Always present review findings to user
- **STOP and wait for explicit user approval**
- User responses like "approved", "looks good", "proceed" = approved
- Do not proceed without approval

### Step 6: Present User Testing Instructions

Present testing instructions to the user **one by one** (not as a batch list):
- Present the first test instruction and wait for the user to confirm pass/fail
- Only after the current test is resolved, present the next test instruction
- If a test fails, the user can choose to:
  - **Fix it now** - address the issue before continuing
  - **Add as a TODO** - add it to the appropriate phase TODO file for later
  - **Accept as known issue** - acknowledge and proceed
- Continue until all user testing instructions have been presented

**STOP and wait for user confirmation** on each test before presenting the next.

### Step 7: Present Final Code Review

After user testing is complete, present a final code review summarizing:
- Any issues discovered during user testing and their resolutions
- Confirmation that all tests still pass after any fixes
- Final assessment of code quality and readiness for commit

**STOP and wait for explicit user approval** before proceeding.

### Step 8: Update Documentation

Update affected documentation files:
- `README.md` - if user-facing changes
- `CLAUDE.md` (AGENTS.md) - if workflow or rules changed
- `docs/SPEC.md` - if technical spec changed
- `docs/architecture.md` - if architecture changed
- `docs/cli.md` - if CLI commands changed
- `docs/bootstrap.md` - if setup changed
- `docs/plugins.md` - if plugins affected
- `docs/roadmap.md` - if roadmap changed
- Inline comments in changed code files

**Never modify `docs/adr/*` or `docs/prd/*`** - ADRs and PRDs are immutable historical records.

**Always update PLAN.md and phase TODO files** - follow [TODO → DONE Movement](WORKFLOWS.md#todo--done-movement) rules from Shared Conventions. Also add new TODOs discovered during implementation and update PLAN.md phase status.

### Step 9: Commit and Push

- **Ask user approval** before committing
- Follow [Commit Message Format](WORKFLOWS.md#commit-message-format) from Shared Conventions
- Execute only after all previous steps complete successfully

### Step 10: Complete

Report completion status and suggest next steps from PLAN.md.

---

## Pre-Commit Checklist

Before every commit:
- [ ] Tests pass (`go test ./...`)
- [ ] Build succeeds (`go build -o cal ./cmd/cal`)
- [ ] Code review presented and user approved (for code changes)
- [ ] User testing instructions presented one by one and resolved
- [ ] Final code review presented and user approved
- [ ] Documentation updated (affected files)
- [ ] PLAN.md updated with current project status
- [ ] Completed TODOs moved from phase TODO file to phase DONE file
- [ ] New TODOs added to appropriate phase TODO file
- [ ] User approved commit operation

---

## Important Notes

### Command Execution Policy

**Ask user approval before running ANY command**, including:
- Git operations (commit, push, branch, merge)
- Build commands
- Test commands
- Script execution
- Package installs
- Any destructive operations

**Exception:** Read/Grep/Glob tools for code searching do not require approval.

### TODO Tracking

See [PLAN.md is Source of Truth](WORKFLOWS.md#planmd-is-source-of-truth) and [TODO → DONE Movement](WORKFLOWS.md#todo--done-movement) in Shared Conventions.

---

## Related Documentation

- [WORKFLOWS.md](WORKFLOWS.md) - Index of all workflows
- [PLAN.md](../PLAN.md) - Project TODOs and status
- [CODING_STANDARDS.md](../CODING_STANDARDS.md) - Code quality standards
