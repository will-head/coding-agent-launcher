# Active Bugs

Active bugs for the CAL project. Agents should only read this file when specifically asked about bugs.

When bugs are resolved, remove the entry from this file and update `bugs/README.md`.

## Severity Definitions

| Severity | Description |
|----------|-------------|
| Critical | Blocks core functionality, no workaround |
| High     | Major feature broken, workaround exists |
| Medium   | Feature degraded, acceptable workarounds |
| Low      | Minor issue, cosmetic, or edge case |

## Status Definitions

| Status      | Description |
|-------------|-------------|
| Open        | Confirmed, not yet being worked on |
| In Progress | Actively being investigated or fixed |
| Blocked     | Waiting on external dependency |

## Active Bugs

| ID | Summary | Severity | Status | Component | Phase | Opened |
|----|---------|----------|--------|-----------|-------|--------|
| BUG-001 | vm-tmux-resurrect.sh not deployed to VM during --init | High | Open | Bootstrap | 0 | 2026-02-01 |
| BUG-002 | Tmux mouse mode breaks terminal copy-on-select and right-click menu | Medium | Open | Bootstrap | 0 | 2026-02-01 |

---

## BUG-001: vm-tmux-resurrect.sh not deployed to VM during --init

**Severity:** High
**Status:** Open
**Component:** Bootstrap (cal-bootstrap, vm-setup.sh)
**Phase:** 0
**Opened:** 2026-02-01

### Description

The `vm-tmux-resurrect.sh` script exists on the host in `scripts/` directory but is not being deployed to the VM's `~/scripts/` directory during `cal-bootstrap --init`. This causes:

1. `vm-setup.sh` fails to configure tmux session persistence (line 702 check fails)
2. No `.tmux.conf` created in VM home directory
3. Tmux session persistence features unavailable (auto-save, auto-restore, pane scrollback preservation)
4. Fresh `--init` installations lack tmux configuration entirely

### Expected Behavior

- `vm-tmux-resurrect.sh` should be deployed to VM alongside other helper scripts (vm-auth.sh, vm-first-run.sh, tmux-wrapper.sh)
- `vm-setup.sh` should successfully call `vm-tmux-resurrect.sh` during init
- `.tmux.conf` should be created with session persistence configuration
- Tmux session persistence should work on fresh installations

### Actual Behavior

- `vm-tmux-resurrect.sh` missing from VM `~/scripts/` directory
- No `.tmux.conf` in VM home directory
- `vm-setup.sh` shows warning: "⚠ vm-tmux-resurrect.sh not found in ~/scripts/"

### Reproduction Steps

1. Run `cal-bootstrap --init` on fresh VM
2. SSH into VM and check `ls ~/scripts/` - `vm-tmux-resurrect.sh` is missing
3. Check `ls -a ~/` - no `.tmux.conf` exists
4. Tmux session persistence features unavailable

### Root Cause

The `cal-bootstrap` script deploys helper scripts via SCP but `vm-tmux-resurrect.sh` was added after the deployment logic was written. The script exists in the host repository but is not included in the SCP copy commands.

### Workaround

Manually copy the script to the VM and run it:
```bash
# From host
scp scripts/vm-tmux-resurrect.sh admin@<VM_IP>:~/scripts/

# In VM
zsh ~/scripts/vm-tmux-resurrect.sh
```

### Fix Required

Update `cal-bootstrap` script to include `vm-tmux-resurrect.sh` in the helper scripts deployment step (likely around the SCP section where other scripts are copied).

---

## BUG-002: Tmux mouse mode breaks terminal copy-on-select and right-click menu

**Severity:** Medium
**Status:** Open
**Component:** Bootstrap (vm-tmux-resurrect.sh, tmux.conf)
**Phase:** 0
**Opened:** 2026-02-01

### Description

The `tmux.conf` generated by `vm-tmux-resurrect.sh` enables tmux mouse mode (`set -g mouse on` at line 60). This conflicts with terminal emulator features:

1. **Copy-on-select stopped working** - Previously, selecting text in terminal would automatically copy it to clipboard. With tmux mouse mode enabled, selection now enters tmux copy mode instead.
2. **Right-click menu broken** - Right-clicking on tmux status bar window names no longer shows the context menu for rename/kill/etc. Tmux captures the mouse event instead of passing it to the terminal.

### Expected Behavior

- Text selection should copy to system clipboard (terminal behavior)
- Right-click on window names should show tmux context menu
- Mouse interactions should feel natural and not require special tmux knowledge

### Actual Behavior

- Text selection enters tmux copy mode (requires `Enter` to copy, doesn't use system clipboard)
- Right-click on status bar has no effect (tmux captures event but doesn't provide menu)
- User experience degraded compared to pre-tmux-config state

### Impact

- **Copy-on-select**: Medium impact - users must learn tmux copy mode or disable mouse mode
- **Right-click menu**: Low-Medium impact - users can use keyboard shortcuts instead (`Ctrl+b ,` to rename window)

### Reproduction Steps

1. Deploy tmux.conf with mouse mode enabled
2. Try to select text in tmux session - enters copy mode instead of copying
3. Right-click on window name in status bar - no menu appears

### Root Cause

Tmux mouse mode (`set -g mouse on`) intercepts all mouse events. This is by design in tmux - it enables scrolling through history, pane selection, and resizing, but breaks terminal-level mouse features.

### Trade-offs

**Mouse mode ON (current):**
- ✅ Click to select panes
- ✅ Drag pane borders to resize
- ✅ Scroll wheel for history navigation
- ❌ Copy-on-select broken
- ❌ Right-click menu broken

**Mouse mode OFF (alternative):**
- ✅ Copy-on-select works
- ✅ Right-click menu works
- ❌ Must use keyboard for pane selection
- ❌ Must use keyboard for resizing
- ❌ Scroll wheel doesn't work for history

### Possible Solutions

1. **Disable mouse mode by default** - Preserve terminal behavior, use keyboard for tmux
2. **Make mouse mode configurable** - Add comment in tmux.conf explaining trade-off, easy to toggle
3. **Use terminal integration mode** - Some terminals support better tmux integration (requires terminal-specific config)
4. **Document workaround** - Explain how to disable mouse mode if user prefers terminal behavior

### Recommended Fix

Option 2: Make mouse mode configurable with clear documentation:

```tmux
# Mouse support - enables pane selection, resizing, and scrolling
# Trade-off: Breaks terminal copy-on-select and right-click menus
# To disable mouse mode: change 'on' to 'off' and reload config (Ctrl+b R)
set -g mouse on
```

### Workaround

Disable mouse mode temporarily or permanently:

**Temporarily (current session):**
```bash
tmux set -g mouse off
```

**Permanently:**
Edit `~/.tmux.conf`, change `set -g mouse on` to `set -g mouse off`, then reload:
```bash
tmux source-file ~/.tmux.conf
```
